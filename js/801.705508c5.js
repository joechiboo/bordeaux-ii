"use strict";(self["webpackChunkbordeaux_ii"]=self["webpackChunkbordeaux_ii"]||[]).push([[801],{5801:function(t,s,a){a.r(s),a.d(s,{default:function(){return gt}});var e=a(6768),n=a(4232),i=a(5130);const o=t=>((0,e.Qi)("data-v-635d6c7e"),t=t(),(0,e.jt)(),t),l={class:"voting-list-container"},c=o((()=>(0,e.Lk)("div",{class:"page-header"},[(0,e.Lk)("h1",{class:"page-title"},"🗳 社區電子投票"),(0,e.Lk)("p",{class:"page-subtitle"},"參與社區事務，共同決定美好未來")],-1))),v={class:"voting-stats"},r={class:"stat-card"},d=o((()=>(0,e.Lk)("div",{class:"stat-icon"},"📊",-1))),u={class:"stat-info"},g={class:"stat-value"},k=o((()=>(0,e.Lk)("div",{class:"stat-label"},"總投票數",-1))),p={class:"stat-card"},L=o((()=>(0,e.Lk)("div",{class:"stat-icon"},"🔥",-1))),f={class:"stat-info"},b={class:"stat-value"},_=o((()=>(0,e.Lk)("div",{class:"stat-label"},"進行中",-1))),h={class:"stat-card"},C=o((()=>(0,e.Lk)("div",{class:"stat-icon"},"✅",-1))),m={class:"stat-info"},y={class:"stat-value"},w=o((()=>(0,e.Lk)("div",{class:"stat-label"},"已參與",-1))),V={class:"voting-tabs"},E=["onClick"],T={key:0,class:"tab-badge"},D={class:"voting-content"},X={key:0,class:"loading-state"},x=o((()=>(0,e.Lk)("div",{class:"spinner"},null,-1))),K=o((()=>(0,e.Lk)("p",null,"載入投票資料中...",-1))),R=[x,K],W={key:1,class:"empty-state"},M=o((()=>(0,e.Lk)("div",{class:"empty-icon"},"📭",-1))),$={class:"empty-message"},I={key:2,class:"voting-grid"},N=["onClick"],P={class:"voting-header"},Q={key:0,class:"voted-badge"},S={class:"voting-title"},A={class:"voting-description"},j={class:"voting-info"},B={class:"info-item"},F=o((()=>(0,e.Lk)("span",{class:"info-icon"},"📅",-1))),q={class:"info-text"},O={class:"info-item"},z=o((()=>(0,e.Lk)("span",{class:"info-icon"},"👥",-1))),G={class:"info-text"},H={class:"info-item"},J=o((()=>(0,e.Lk)("span",{class:"info-icon"},"🎯",-1))),U={class:"info-text"},Y={class:"voting-progress"},Z={class:"progress-bar"},tt={class:"progress-text"},st=["onClick"],at={key:0,class:"notification-bar"},et=o((()=>(0,e.Lk)("span",{class:"notification-icon"},"🔔",-1))),nt={class:"notification-text"};function it(t,s,a,o,x,K){return(0,e.uX)(),(0,e.CE)("div",l,[c,(0,e.Lk)("div",v,[(0,e.Lk)("div",r,[d,(0,e.Lk)("div",u,[(0,e.Lk)("div",g,(0,n.v_)(o.stats.total),1),k])]),(0,e.Lk)("div",p,[L,(0,e.Lk)("div",f,[(0,e.Lk)("div",b,(0,n.v_)(o.stats.ongoing),1),_])]),(0,e.Lk)("div",h,[C,(0,e.Lk)("div",m,[(0,e.Lk)("div",y,(0,n.v_)(o.stats.participated),1),w])])]),(0,e.Lk)("div",V,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(o.tabs,(t=>((0,e.uX)(),(0,e.CE)("button",{key:t.value,class:(0,n.C4)(["tab-btn",{active:o.activeTab===t.value}]),onClick:s=>o.activeTab=t.value},[(0,e.eW)((0,n.v_)(t.label)+" ",1),o.getTabCount(t.value)>0?((0,e.uX)(),(0,e.CE)("span",T,(0,n.v_)(o.getTabCount(t.value)),1)):(0,e.Q3)("",!0)],10,E)))),128))]),(0,e.Lk)("div",D,[o.loading?((0,e.uX)(),(0,e.CE)("div",X,R)):0===o.filteredVotings.length?((0,e.uX)(),(0,e.CE)("div",W,[M,(0,e.Lk)("p",$,"目前沒有"+(0,n.v_)(o.activeTabLabel)+"的投票",1)])):((0,e.uX)(),(0,e.CE)("div",I,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(o.filteredVotings,(t=>((0,e.uX)(),(0,e.CE)("div",{key:t.id,class:"voting-card",onClick:s=>o.goToVoting(t.id)},[(0,e.Lk)("div",P,[(0,e.Lk)("span",{class:(0,n.C4)(["voting-status",t.status])},(0,n.v_)(o.getStatusLabel(t.status)),3),t.hasVoted?((0,e.uX)(),(0,e.CE)("span",Q,"已投票")):(0,e.Q3)("",!0)]),(0,e.Lk)("h3",S,(0,n.v_)(t.title),1),(0,e.Lk)("p",A,(0,n.v_)(t.description),1),(0,e.Lk)("div",j,[(0,e.Lk)("div",B,[F,(0,e.Lk)("span",q,(0,n.v_)(o.formatDate(t.start_date))+" - "+(0,n.v_)(o.formatDate(t.end_date)),1)]),(0,e.Lk)("div",O,[z,(0,e.Lk)("span",G,(0,n.v_)(t.vote_count||0)+" 人已投票",1)]),(0,e.Lk)("div",H,[J,(0,e.Lk)("span",U,(0,n.v_)("single"===t.voting_type?"單選":"多選"),1)])]),(0,e.Lk)("div",Y,[(0,e.Lk)("div",Z,[(0,e.Lk)("div",{class:"progress-fill",style:(0,n.Tr)({width:o.getProgressWidth(t)+"%"})},null,4)]),(0,e.Lk)("span",tt," 參與率: "+(0,n.v_)(o.getProgressWidth(t))+"% ",1)]),(0,e.Lk)("button",{class:(0,n.C4)(["action-btn",{"btn-primary":!t.hasVoted&&"ongoing"===t.status,"btn-secondary":t.hasVoted||"ongoing"!==t.status}]),onClick:(0,i.D$)((s=>o.goToVoting(t.id)),["stop"])},(0,n.v_)(o.getActionButtonText(t)),11,st)],8,N)))),128))]))]),o.showNotification?((0,e.uX)(),(0,e.CE)("div",at,[et,(0,e.Lk)("span",nt,(0,n.v_)(o.notificationMessage),1),(0,e.Lk)("button",{class:"notification-close",onClick:s[0]||(s[0]=t=>o.showNotification=!1)},"×")])):(0,e.Q3)("",!0)])}a(4114);var ot=a(144),lt=a(1387),ct=a(5003),vt=a(782),rt={name:"VotingList",setup(){const t=(0,lt.rd)(),s=(0,vt.Pj)(),a=(0,ot.KR)(!0),n=(0,ot.KR)([]),i=(0,ot.KR)("ongoing"),o=(0,ot.KR)(!1),l=(0,ot.KR)(""),c=(0,ot.KR)({total:0,ongoing:0,participated:0}),v=[{label:"進行中",value:"ongoing"},{label:"即將開始",value:"upcoming"},{label:"已結束",value:"ended"},{label:"全部",value:"all"}],r=(0,e.EW)((()=>{const t=v.find((t=>t.value===i.value));return t?t.label:""})),d=(0,e.EW)((()=>"all"===i.value?n.value:n.value.filter((t=>t.status===i.value)))),u=t=>"all"===t?n.value.length:n.value.filter((s=>s.status===t)).length,g=t=>{const s={upcoming:"即將開始",ongoing:"進行中",ended:"已結束"};return s[t]||t},k=t=>{const s=new Date(t);return`${s.getMonth()+1}/${s.getDate()}`},p=t=>{const s=100;return Math.min(Math.round(t.vote_count/s*100),100)},L=t=>{if(t.hasVoted)return"查看結果";switch(t.status){case"upcoming":return"查看詳情";case"ongoing":return"立即投票";case"ended":return"查看結果";default:return"查看詳情"}},f=s=>{t.push(`/voting/${s}`)},b=async()=>{try{a.value=!0;const t=(new Date).toISOString(),{data:e,error:i}=await ct.ND.from("voting_topics").select("\n            *,\n            voting_records (\n              user_id\n            ),\n            voting_results (\n              vote_count\n            )\n          ").eq("is_active",!0).order("created_at",{ascending:!1});if(i)throw i;const v=e.map((a=>{const e=a.voting_results?.reduce(((t,s)=>t+s.vote_count),0)||0;let n="upcoming";return n=new Date(a.start_date)>new Date(t)?"upcoming":new Date(a.end_date)<new Date(t)?"ended":"ongoing",{...a,status:n,vote_count:e,hasVoted:a.voting_records?.some((t=>t.user_id===s.state.user?.id))||!1}}));n.value=v,c.value={total:v.length,ongoing:v.filter((t=>"ongoing"===t.status)).length,participated:v.filter((t=>t.hasVoted)).length};const r=v.filter((t=>"ongoing"===t.status&&!t.hasVoted)).length;r>0&&!o.value&&(l.value=`您有 ${r} 個進行中的投票，請記得參與！`,o.value=!0)}catch(t){console.error("Error fetching votings:",t)}finally{a.value=!1}};return(0,e.sV)((()=>{b()})),{loading:a,votings:n,activeTab:i,activeTabLabel:r,filteredVotings:d,stats:c,tabs:v,showNotification:o,notificationMessage:l,getTabCount:u,getStatusLabel:g,formatDate:k,getProgressWidth:p,getActionButtonText:L,goToVoting:f}}},dt=a(1241);const ut=(0,dt.A)(rt,[["render",it],["__scopeId","data-v-635d6c7e"]]);var gt=ut}}]);
//# sourceMappingURL=801.705508c5.js.map