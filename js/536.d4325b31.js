"use strict";(self["webpackChunkbordeaux_ii"]=self["webpackChunkbordeaux_ii"]||[]).push([[536],{1536:function(t,a,e){e.r(a),e.d(a,{default:function(){return Sa}});var s=e(6768),l=e(4232),i=e(5130);const o=t=>((0,s.Qi)("data-v-5b145910"),t=t(),(0,s.jt)(),t),n={class:"voting-detail-container"},c={key:0,class:"loading-state"},r=o((()=>(0,s.Lk)("div",{class:"spinner"},null,-1))),d=o((()=>(0,s.Lk)("p",null,"è¼‰å…¥æŠ•ç¥¨è³‡æ–™ä¸­...",-1))),u=[r,d],v={key:1,class:"error-state"},g=o((()=>(0,s.Lk)("div",{class:"error-icon"},"âŒ",-1))),k=o((()=>(0,s.Lk)("p",null,"æ‰¾ä¸åˆ°æŠ•ç¥¨è³‡æ–™",-1))),p={class:"voting-header"},h={class:"header-content"},L={class:"voting-title"},m={class:"voting-meta"},b={key:0,class:"voted-badge"},f={class:"voting-info-card"},C={class:"info-section"},_=o((()=>(0,s.Lk)("h3",null,"ğŸ“Œ æŠ•ç¥¨èªªæ˜",-1))),y={class:"info-grid"},E={class:"info-item"},X=o((()=>(0,s.Lk)("span",{class:"info-label"},"ğŸ“… æŠ•ç¥¨æœŸé–“",-1))),w={class:"info-value"},D={class:"info-item"},V=o((()=>(0,s.Lk)("span",{class:"info-label"},"ğŸ‘¥ æŠ•ç¥¨å°è±¡",-1))),R={class:"info-value"},x={class:"info-item"},S=o((()=>(0,s.Lk)("span",{class:"info-label"},"ğŸ” æŠ•ç¥¨æ–¹å¼",-1))),F={class:"info-value"},K={class:"info-item"},T=o((()=>(0,s.Lk)("span",{class:"info-label"},"ğŸ“ˆ æŠ•ç¥¨ç›®çš„",-1))),Q={class:"info-value"},I={key:0,class:"attachments"},M=o((()=>(0,s.Lk)("h3",null,"ğŸ“ é™„ä»¶è³‡æ–™",-1))),O={class:"attachment-list"},B=["href"],W={key:0,class:"voting-options"},$=o((()=>(0,s.Lk)("h2",{class:"section-title"},"ğŸ”˜ è«‹é¸æ“‡æ‚¨çš„æŠ•ç¥¨é¸é …",-1))),A={class:"options-list"},j=["name","value"],H={class:"option-content"},U={class:"option-title"},P={key:0,class:"option-description"},q={class:"voting-actions"},G=["disabled"],N={key:1,class:"voting-results"},Y=o((()=>(0,s.Lk)("h2",{class:"section-title"},"ğŸ“Š æŠ•ç¥¨çµæœ",-1))),z={class:"voting-notice"},J=o((()=>(0,s.Lk)("h3",null,"ğŸ“£ å‚™è¨»",-1))),Z={key:0},tt=o((()=>(0,s.Lk)("li",null,"è‹¥ç„¡æ³•ç·šä¸ŠæŠ•ç¥¨ï¼Œå¯è‡³ç®¡ç†å®¤å¡«å¯«ç´™æœ¬é¸ç¥¨",-1))),at=o((()=>(0,s.Lk)("li",null,"æŠ•ç¥¨æ¡åŒ¿ååˆ¶ï¼Œæ‚¨çš„å€‹äººè³‡è¨Šå°‡è¢«ä¿å¯†",-1))),et=o((()=>(0,s.Lk)("h3",{class:"modal-title"},"ç¢ºèªæŠ•ç¥¨",-1))),st={class:"modal-message"},lt=o((()=>(0,s.Lk)("p",{class:"modal-warning"},"æŠ•ç¥¨å¾Œç„¡æ³•æ›´æ”¹ï¼Œè«‹ç¢ºèªæ‚¨çš„é¸æ“‡",-1))),it={class:"modal-actions"},ot={key:4,class:"success-message"},nt=o((()=>(0,s.Lk)("span",{class:"success-icon"},"âœ…",-1))),ct=o((()=>(0,s.Lk)("span",null,"æŠ•ç¥¨æˆåŠŸï¼æ„Ÿè¬æ‚¨çš„åƒèˆ‡",-1))),rt=[nt,ct];function dt(t,a,e,o,r,d){const nt=(0,s.g2)("VotingChart");return(0,s.uX)(),(0,s.CE)("div",n,[o.loading?((0,s.uX)(),(0,s.CE)("div",c,u)):o.voting?((0,s.uX)(),(0,s.CE)(s.FK,{key:2},[(0,s.Lk)("div",p,[(0,s.Lk)("button",{class:"btn-back",onClick:a[1]||(a[1]=(...t)=>o.goBack&&o.goBack(...t))}," â† è¿”å›åˆ—è¡¨ "),(0,s.Lk)("div",h,[(0,s.Lk)("h1",L,(0,l.v_)(o.voting.title),1),(0,s.Lk)("div",m,[(0,s.Lk)("span",{class:(0,l.C4)(["status-badge",o.voting.status])},(0,l.v_)(o.getStatusLabel(o.voting.status)),3),o.hasVoted?((0,s.uX)(),(0,s.CE)("span",b,"âœ“ å·²æŠ•ç¥¨")):(0,s.Q3)("",!0)])])]),(0,s.Lk)("div",f,[(0,s.Lk)("div",C,[_,(0,s.Lk)("p",null,(0,l.v_)(o.voting.description),1)]),(0,s.Lk)("div",y,[(0,s.Lk)("div",E,[X,(0,s.Lk)("span",w,(0,l.v_)(o.formatFullDate(o.voting.start_date))+" ~ "+(0,l.v_)(o.formatFullDate(o.voting.end_date)),1)]),(0,s.Lk)("div",D,[V,(0,s.Lk)("span",R,(0,l.v_)(o.voting.target_audience||"æœ¬ç¤¾å€ä½æˆ¶"),1)]),(0,s.Lk)("div",x,[S,(0,s.Lk)("span",F,(0,l.v_)("single"===o.voting.voting_type?"å–®é¸åˆ¶":"å¤šé¸åˆ¶"),1)]),(0,s.Lk)("div",K,[T,(0,s.Lk)("span",Q,(0,l.v_)(o.voting.purpose||"ä¾å¤šæ•¸æ„è¦‹æ±ºå®š"),1)])]),o.voting.attachments&&o.voting.attachments.length>0?((0,s.uX)(),(0,s.CE)("div",I,[M,(0,s.Lk)("ul",O,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.voting.attachments,((t,a)=>((0,s.uX)(),(0,s.CE)("li",{key:a},[(0,s.Lk)("a",{href:t.url,target:"_blank",class:"attachment-link"},(0,l.v_)(t.name),9,B)])))),128))])])):(0,s.Q3)("",!0)]),o.hasVoted||"ongoing"!==o.voting.status?(0,s.Q3)("",!0):((0,s.uX)(),(0,s.CE)("div",W,[$,(0,s.Lk)("div",A,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(o.voting.voting_options,(t=>((0,s.uX)(),(0,s.CE)("label",{key:t.id,class:(0,l.C4)(["option-card",{selected:o.selectedOption===t.id}])},[(0,s.bo)((0,s.Lk)("input",{type:"radio",name:`voting-${o.voting.id}`,value:t.id,"onUpdate:modelValue":a[2]||(a[2]=t=>o.selectedOption=t),class:"option-radio"},null,8,j),[[i.XL,o.selectedOption]]),(0,s.Lk)("div",H,[(0,s.Lk)("h4",U,(0,l.v_)(t.option_text),1),t.description?((0,s.uX)(),(0,s.CE)("p",P,(0,l.v_)(t.description),1)):(0,s.Q3)("",!0)])],2)))),128))]),(0,s.Lk)("div",q,[(0,s.Lk)("button",{class:"btn-submit",disabled:!o.selectedOption||o.submitting,onClick:a[3]||(a[3]=(...t)=>o.submitVote&&o.submitVote(...t))},(0,l.v_)(o.submitting?"æäº¤ä¸­...":"ç¢ºèªæŠ•ç¥¨"),9,G)])])),o.hasVoted||"ended"===o.voting.status?((0,s.uX)(),(0,s.CE)("div",N,[Y,(0,s.bF)(nt,{results:o.results,statistics:o.statistics},null,8,["results","statistics"])])):(0,s.Q3)("",!0),(0,s.Lk)("div",z,[J,(0,s.Lk)("ul",null,["ongoing"===o.voting.status?((0,s.uX)(),(0,s.CE)("li",Z," æŠ•ç¥¨çµæœå°‡æ–¼ "+(0,l.v_)(o.formatFullDate(o.voting.end_date))+" å¾Œå…¬å‘Š ",1)):(0,s.Q3)("",!0),tt,at])])],64)):((0,s.uX)(),(0,s.CE)("div",v,[g,k,(0,s.Lk)("button",{class:"btn-back",onClick:a[0]||(a[0]=(...t)=>o.goBack&&o.goBack(...t))},"è¿”å›æŠ•ç¥¨åˆ—è¡¨")])),o.showConfirmModal?((0,s.uX)(),(0,s.CE)("div",{key:3,class:"modal-overlay",onClick:a[7]||(a[7]=t=>o.showConfirmModal=!1)},[(0,s.Lk)("div",{class:"modal-content",onClick:a[6]||(a[6]=(0,i.D$)((()=>{}),["stop"]))},[et,(0,s.Lk)("p",st,[(0,s.eW)(" æ‚¨é¸æ“‡çš„æ˜¯ï¼š"),(0,s.Lk)("strong",null,(0,l.v_)(o.getSelectedOptionText()),1)]),lt,(0,s.Lk)("div",it,[(0,s.Lk)("button",{class:"btn-cancel",onClick:a[4]||(a[4]=t=>o.showConfirmModal=!1)},"å–æ¶ˆ"),(0,s.Lk)("button",{class:"btn-confirm",onClick:a[5]||(a[5]=(...t)=>o.confirmVote&&o.confirmVote(...t))},"ç¢ºèªæŠ•ç¥¨")])])])):(0,s.Q3)("",!0),o.showSuccessMessage?((0,s.uX)(),(0,s.CE)("div",ot,rt)):(0,s.Q3)("",!0)])}e(4114);var ut=e(144),vt=e(1387),gt=e(5003),kt=e(782);const pt=t=>((0,s.Qi)("data-v-70ba68f0"),t=t(),(0,s.jt)(),t),ht={class:"voting-chart-container"},Lt={class:"chart-tabs"},mt=["onClick"],bt={class:"chart-content"},ft={key:0,class:"chart-section"},Ct=pt((()=>(0,s.Lk)("h3",{class:"chart-title"},"ğŸ“Š æŠ•ç¥¨çµæœé•·æ¢åœ–",-1))),_t={class:"bar-chart"},yt={class:"bar-label"},Et={class:"option-text"},Xt={class:"bar-value"},wt={class:"bar-container"},Dt={key:1,class:"chart-section"},Vt=pt((()=>(0,s.Lk)("h3",{class:"chart-title"},"ğŸ¥§ æŠ•ç¥¨çµæœåœ“é¤…åœ–",-1))),Rt={class:"pie-chart-container"},xt={class:"pie-chart-wrapper"},St={class:"pie-chart-svg",viewBox:"0 0 200 200"},Ft={class:"pie-chart-group"},Kt=["stroke","stroke-dasharray","stroke-dashoffset"],Tt=pt((()=>(0,s.Lk)("text",{x:"100",y:"100","text-anchor":"middle","dominant-baseline":"middle",class:"pie-center-text"}," ç¸½æŠ•ç¥¨æ•¸ ",-1))),Qt={x:"100",y:"115","text-anchor":"middle","dominant-baseline":"middle",class:"pie-center-number"},It={class:"pie-legend"},Mt={class:"legend-text"},Ot={key:2,class:"chart-section"},Bt=pt((()=>(0,s.Lk)("h3",{class:"chart-title"},"ğŸ¢ æ¨“å±¤æŠ•ç¥¨åˆ†å¸ƒç†±åŠ›åœ–",-1))),Wt={key:0,class:"heatmap-container"},$t={class:"floor-grid"},At={class:"floor-label"},jt={class:"floor-count"},Ht=(0,s.Fv)('<div class="heatmap-legend" data-v-70ba68f0><span class="legend-title" data-v-70ba68f0>æŠ•ç¥¨äººæ•¸ï¼š</span><div class="heat-scale" data-v-70ba68f0><div class="heat-level heat-low" data-v-70ba68f0>å°‘</div><div class="heat-level heat-medium" data-v-70ba68f0>ä¸­</div><div class="heat-level heat-high" data-v-70ba68f0>å¤š</div></div></div>',1),Ut={key:1,class:"no-floor-data"},Pt=pt((()=>(0,s.Lk)("p",null,"æš«ç„¡æ¨“å±¤åˆ†å¸ƒæ•¸æ“š",-1))),qt=[Pt],Gt={key:3,class:"chart-section"},Nt=pt((()=>(0,s.Lk)("h3",{class:"chart-title"},"ğŸ“ˆ åƒèˆ‡ç‡çµ±è¨ˆ",-1))),Yt={class:"stats-dashboard"},zt={class:"stat-cards"},Jt={class:"stat-card primary"},Zt=pt((()=>(0,s.Lk)("div",{class:"stat-icon"},"ğŸ—³",-1))),ta={class:"stat-content"},aa={class:"stat-value"},ea=pt((()=>(0,s.Lk)("div",{class:"stat-label"},"ç¸½æŠ•ç¥¨æ•¸",-1))),sa={class:"stat-card success"},la=pt((()=>(0,s.Lk)("div",{class:"stat-icon"},"ğŸ“Š",-1))),ia={class:"stat-content"},oa={class:"stat-value"},na=pt((()=>(0,s.Lk)("div",{class:"stat-label"},"åƒèˆ‡ç‡",-1))),ca={class:"stat-card warning"},ra=pt((()=>(0,s.Lk)("div",{class:"stat-icon"},"ğŸ ",-1))),da={class:"stat-content"},ua={class:"stat-value"},va=pt((()=>(0,s.Lk)("div",{class:"stat-label"},"ç¸½æˆ¶æ•¸",-1))),ga={class:"participation-progress"},ka={class:"progress-header"},pa=pt((()=>(0,s.Lk)("span",{class:"progress-title"},"ç¸½é«”åƒèˆ‡é€²åº¦",-1))),ha={class:"progress-percentage"},La={class:"progress-bar"},ma=pt((()=>(0,s.Lk)("div",{class:"progress-labels"},[(0,s.Lk)("span",null,"0%"),(0,s.Lk)("span",null,"50%"),(0,s.Lk)("span",null,"100%")],-1))),ba={key:0,class:"time-series"},fa=pt((()=>(0,s.Lk)("h4",null,"æŠ•ç¥¨æ™‚é–“åˆ†å¸ƒ",-1))),Ca={class:"time-chart"},_a=["title"],ya={class:"time-label"};function Ea(t,a,e,i,o,n){return(0,s.uX)(),(0,s.CE)("div",ht,[(0,s.Lk)("div",Lt,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.chartTabs,(t=>((0,s.uX)(),(0,s.CE)("button",{key:t.value,class:(0,l.C4)(["chart-tab",{active:i.activeChart===t.value}]),onClick:a=>i.activeChart=t.value},(0,l.v_)(t.icon)+" "+(0,l.v_)(t.label),11,mt)))),128))]),(0,s.Lk)("div",bt,["bar"===i.activeChart?((0,s.uX)(),(0,s.CE)("div",ft,[Ct,(0,s.Lk)("div",_t,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.sortedResults,((t,a)=>((0,s.uX)(),(0,s.CE)("div",{key:t.option_id,class:"bar-item",style:(0,l.Tr)({animationDelay:.1*a+"s"})},[(0,s.Lk)("div",yt,[(0,s.Lk)("span",Et,(0,l.v_)(t.voting_options?.option_text),1),(0,s.Lk)("span",Xt,(0,l.v_)(t.vote_count)+" ç¥¨ ("+(0,l.v_)(t.percentage)+"%)",1)]),(0,s.Lk)("div",wt,[(0,s.Lk)("div",{class:"bar-fill",style:(0,l.Tr)({width:i.getBarWidth(t.percentage)+"%",background:i.getBarGradient(a)})},null,4)])],4)))),128))])])):(0,s.Q3)("",!0),"pie"===i.activeChart?((0,s.uX)(),(0,s.CE)("div",Dt,[Vt,(0,s.Lk)("div",Rt,[(0,s.Lk)("div",xt,[((0,s.uX)(),(0,s.CE)("svg",St,[(0,s.Lk)("g",Ft,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.sortedResults,((t,a)=>((0,s.uX)(),(0,s.CE)("circle",{key:t.option_id,class:"pie-slice",cx:100,cy:100,r:80,fill:"transparent",stroke:i.getSliceColor(a),"stroke-width":60,"stroke-dasharray":`${i.getSliceDashArray(t.percentage)} ${i.circumference}`,"stroke-dashoffset":i.getSliceOffset(a),style:(0,l.Tr)({animationDelay:.2*a+"s"})},null,12,Kt)))),128))]),Tt,(0,s.Lk)("text",Qt,(0,l.v_)(i.totalVotes),1)]))]),(0,s.Lk)("div",It,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.sortedResults,((t,a)=>((0,s.uX)(),(0,s.CE)("div",{key:t.option_id,class:"legend-item"},[(0,s.Lk)("span",{class:"legend-color",style:(0,l.Tr)({background:i.getSliceColor(a)})},null,4),(0,s.Lk)("span",Mt,(0,l.v_)(t.voting_options?.option_text)+" ("+(0,l.v_)(t.percentage)+"%) ",1)])))),128))])])])):(0,s.Q3)("",!0),"heatmap"===i.activeChart?((0,s.uX)(),(0,s.CE)("div",Ot,[Bt,i.floorData&&Object.keys(i.floorData).length>0?((0,s.uX)(),(0,s.CE)("div",Wt,[(0,s.Lk)("div",$t,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.floorData,((t,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:(0,l.C4)(["floor-cell",i.getFloorHeatClass(t)]),style:(0,l.Tr)({animationDelay:.5*Math.random()+"s"})},[(0,s.Lk)("div",At,(0,l.v_)(a)+"F",1),(0,s.Lk)("div",jt,(0,l.v_)(t),1)],6)))),128))]),Ht])):((0,s.uX)(),(0,s.CE)("div",Ut,qt))])):(0,s.Q3)("",!0),"stats"===i.activeChart?((0,s.uX)(),(0,s.CE)("div",Gt,[Nt,(0,s.Lk)("div",Yt,[(0,s.Lk)("div",zt,[(0,s.Lk)("div",Jt,[Zt,(0,s.Lk)("div",ta,[(0,s.Lk)("div",aa,(0,l.v_)(i.totalVotes),1),ea])]),(0,s.Lk)("div",sa,[la,(0,s.Lk)("div",ia,[(0,s.Lk)("div",oa,(0,l.v_)(i.participationRate)+"%",1),na])]),(0,s.Lk)("div",ca,[ra,(0,s.Lk)("div",da,[(0,s.Lk)("div",ua,(0,l.v_)(i.totalHouseholds),1),va])])]),(0,s.Lk)("div",ga,[(0,s.Lk)("div",ka,[pa,(0,s.Lk)("span",ha,(0,l.v_)(i.participationRate)+"%",1)]),(0,s.Lk)("div",La,[(0,s.Lk)("div",{class:"progress-fill",style:(0,l.Tr)({width:i.participationRate+"%"})},null,4)]),ma]),i.timeSeriesData&&i.timeSeriesData.length>0?((0,s.uX)(),(0,s.CE)("div",ba,[fa,(0,s.Lk)("div",Ca,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(i.timeSeriesData,((t,a)=>((0,s.uX)(),(0,s.CE)("div",{key:a,class:"time-bar",style:(0,l.Tr)({height:t.count/i.maxTimeCount*100+"%",animationDelay:.1*a+"s"}),title:`${t.hour}:00 - ${t.count} ç¥¨`},[(0,s.Lk)("div",ya,(0,l.v_)(t.hour),1)],12,_a)))),128))])])):(0,s.Q3)("",!0)])])):(0,s.Q3)("",!0)])])}var Xa={name:"VotingChart",props:{results:{type:Array,default:()=>[]},statistics:{type:Object,default:()=>({})}},setup(t){const a=(0,ut.KR)("bar"),e=[{value:"bar",label:"é•·æ¢åœ–",icon:"ğŸ“Š"},{value:"pie",label:"åœ“é¤…åœ–",icon:"ğŸ¥§"},{value:"heatmap",label:"æ¨“å±¤åˆ†å¸ƒ",icon:"ğŸ¢"},{value:"stats",label:"çµ±è¨ˆæ•¸æ“š",icon:"ğŸ“ˆ"}],l=(0,s.EW)((()=>[...t.results].sort(((t,a)=>a.vote_count-t.vote_count)))),i=(0,s.EW)((()=>t.results.reduce(((t,a)=>t+a.vote_count),0))),o=(0,s.EW)((()=>t.statistics.participationRate||"0")),n=(0,s.EW)((()=>t.statistics.totalHouseholds||100)),c=(0,s.EW)((()=>t.statistics.floorDistribution||{})),r=(0,s.EW)((()=>{const t=Array.from({length:24},((t,a)=>a));return t.map((t=>({hour:t.toString().padStart(2,"0"),count:Math.floor(10*Math.random())+1})))})),d=(0,s.EW)((()=>Math.max(...r.value.map((t=>t.count))))),u=502.4,v=t=>Math.min(t,100),g=t=>{const a=["linear-gradient(135deg, #667eea 0%, #764ba2 100%)","linear-gradient(135deg, #f093fb 0%, #f5576c 100%)","linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)","linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)","linear-gradient(135deg, #fa709a 0%, #fee140 100%)"];return a[t%a.length]},k=t=>{const a=["#667eea","#f093fb","#4facfe","#43e97b","#fa709a"];return a[t%a.length]},p=t=>t/100*u,h=t=>{let a=0;for(let e=0;e<t;e++)a+=p(l.value[e].percentage);return-a},L=t=>{const a=Math.max(...Object.values(c.value)),e=t/a;return e>.7?"heat-high":e>.4?"heat-medium":"heat-low"};return{activeChart:a,chartTabs:e,sortedResults:l,totalVotes:i,participationRate:o,totalHouseholds:n,floorData:c,timeSeriesData:r,maxTimeCount:d,circumference:u,getBarWidth:v,getBarGradient:g,getSliceColor:k,getSliceDashArray:p,getSliceOffset:h,getFloorHeatClass:L}}},wa=e(1241);const Da=(0,wa.A)(Xa,[["render",Ea],["__scopeId","data-v-70ba68f0"]]);var Va=Da,Ra={name:"VotingDetail",components:{VotingChart:Va},setup(){const t=(0,vt.lq)(),a=(0,vt.rd)(),e=(0,kt.Pj)(),l=(0,ut.KR)(!0),i=(0,ut.KR)(null),o=(0,ut.KR)(null),n=(0,ut.KR)(!1),c=(0,ut.KR)(null),r=(0,ut.KR)(!1),d=(0,ut.KR)(!1),u=(0,ut.KR)(!1),v=(0,ut.KR)([]),g=(0,ut.KR)({totalVotes:0,participationRate:"0",floorDistribution:null});let k=null;const p=(0,s.EW)((()=>[...v.value].sort(((t,a)=>a.vote_count-t.vote_count)))),h=t=>{const a={upcoming:"å³å°‡é–‹å§‹",ongoing:"é€²è¡Œä¸­",ended:"å·²çµæŸ"};return a[t]||t},L=t=>{const a=new Date(t);return`${a.getFullYear()}/${a.getMonth()+1}/${a.getDate()}`},m=t=>t>=50?"linear-gradient(135deg, #10b981, #059669)":t>=30?"linear-gradient(135deg, #667eea, #764ba2)":"linear-gradient(135deg, #f59e0b, #d97706)",b=()=>{const t=i.value?.voting_options?.find((t=>t.id===o.value));return t?.option_text||""},f=()=>{a.push("/voting")},C=async()=>{try{l.value=!0;const a=t.params.id,s=await gt.ir.getVotingTopic(a),o=new Date;new Date(s.start_date)>o?s.status="upcoming":new Date(s.end_date)<o?s.status="ended":s.status="ongoing",i.value=s;const r=e.state.user?.id;if(r){const t=await gt.ir.checkUserVoted(a,r);t&&(n.value=!0,c.value=t)}(n.value||"ended"===s.status)&&await _(),"ongoing"===s.status&&X(a)}catch(a){console.error("Error fetching voting detail:",a)}finally{l.value=!1}},_=async()=>{try{const a=t.params.id,[e,s]=await Promise.all([gt.ir.getVotingResults(a),gt.ir.getVotingStatistics(a)]);v.value=e,g.value=s}catch(a){console.error("Error fetching results:",a)}},y=()=>{o.value&&(d.value=!0)},E=async()=>{try{r.value=!0,d.value=!1;const l=t.params.id,i=e.state.user?.id;if(console.log("æŠ•ç¥¨æª¢æŸ¥ - ç”¨æˆ¶ID:",i),console.log("æŠ•ç¥¨æª¢æŸ¥ - èªè­‰ç‹€æ…‹:",e.state.isAuthenticated),!i||!e.state.isAuthenticated){alert("è«‹å…ˆç™»å…¥å¾Œå†æŠ•ç¥¨");const e=t.fullPath;return console.log("è·³è½‰åˆ°ç™»å…¥é é¢ï¼Œè¿”å›URL:",e),console.log("å®Œæ•´è·¯ç”±è³‡è¨Š:",t),void a.push({path:"/login",query:{returnTo:e,from:"voting"}})}const v={floor_number:e.state.user?.floor_number,unit_number:e.state.user?.unit_number};console.log("æº–å‚™æäº¤æŠ•ç¥¨:",{topicId:l,selectedOption:o.value,userId:i,additionalData:v});const{data:g,error:k}=await gt.ND.from("voting_records").insert([{topic_id:l,user_id:i,option_id:o.value,floor_number:v.floor_number,unit_number:v.unit_number,user_agent:navigator.userAgent}]).select().single();if(k)throw console.error("Supabase insert error:",k),k;console.log("æŠ•ç¥¨æˆåŠŸ:",g),n.value=!0,c.value=g,u.value=!0;try{await _()}catch(s){console.warn("æ›´æ–°çµæœå¤±æ•—ï¼Œä½†æŠ•ç¥¨æˆåŠŸ:",s)}setTimeout((()=>{u.value=!1}),3e3)}catch(l){console.error("Error submitting vote:",l),console.error("Error details:",l);let t="æŠ•ç¥¨å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦";"23505"===l.code?t="æ‚¨å·²ç¶“æŠ•éç¥¨äº†ï¼":l.message&&(t=`æŠ•ç¥¨å¤±æ•—ï¼š${l.message}`),alert(t)}finally{r.value=!1}},X=t=>{k=gt.ir.subscribeToVotingUpdates(t,(async t=>{console.log("Voting update:",t),await _()}))};return(0,s.sV)((()=>{C()})),(0,s.hi)((()=>{k&&gt.ir.unsubscribeFromVotingUpdates(k)})),{loading:l,voting:i,selectedOption:o,hasVoted:n,userVote:c,submitting:r,showConfirmModal:d,showSuccessMessage:u,results:v,sortedResults:p,statistics:g,getStatusLabel:h,formatFullDate:L,getBarColor:m,getSelectedOptionText:b,goBack:f,submitVote:y,confirmVote:E}}};const xa=(0,wa.A)(Ra,[["render",dt],["__scopeId","data-v-5b145910"]]);var Sa=xa}}]);
//# sourceMappingURL=536.d4325b31.js.map